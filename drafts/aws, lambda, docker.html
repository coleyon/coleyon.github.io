
<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="True" name="HandheldFriendly"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta content="index, follow" name="robots"/>
<link href="https://fonts.gstatic.com" rel="preconnect"/>
<!-- <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet"> -->
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;300;700&amp;family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&amp;display=swap" rel="stylesheet"/>
<link href="https://coleyon.github.io/theme/stylesheet/style.less" rel="stylesheet/less" type="text/css"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js" type="text/javascript"></script>
<link href="https://coleyon.github.io/theme/pygments/github.min.css" id="pygments-light-theme" rel="stylesheet" type="text/css"/>
<link href="https://coleyon.github.io/theme/tipuesearch/tipuesearch.min.css" rel="stylesheet">
<link href="https://coleyon.github.io/theme/font-awesome/css/fontawesome.css" rel="stylesheet" type="text/css"/>
<link href="https://coleyon.github.io/theme/font-awesome/css/brands.css" rel="stylesheet" type="text/css"/>
<link href="https://coleyon.github.io/theme/font-awesome/css/solid.css" rel="stylesheet" type="text/css"/>
<link href="https://coleyon.github.io/static/custom.css" rel="stylesheet"/>
<link href="https://coleyon.github.io/feeds/all.atom.xml" rel="alternate" title="wof Atom" type="application/atom+xml"/>
<link href="https://coleyon.github.io/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
<link href="https://coleyon.github.io/images/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-RCE39CRW4N', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
<meta content="Coleyon" name="author"/>
<meta content="AWS Lambda 関数のデプロイパッケージ形態に、Docker コンテナイメージを選択できるようになりました。" name="description"/>
<meta content="AWS, AWS Lambda, docker, python" name="keywords"/>
<meta content="wof" property="og:site_name">
<meta content="AWS Lambda をコンテナイメージでデプロイする" property="og:title"/>
<meta content="AWS Lambda 関数のデプロイパッケージ形態に、Docker コンテナイメージを選択できるようになりました。" property="og:description"/>
<meta content="ja_JP" property="og:locale"/>
<meta content="https://coleyon.github.io/drafts/aws, lambda, docker.html" property="og:url"/>
<meta content="article" property="og:type"/>
<meta content="2021-05-29 12:00:00+09:00" property="article:published_time"/>
<meta content="2021-05-29 12:00:00+09:00" property="article:modified_time"/>
<meta content="https://coleyon.github.io/author/coleyon.html" property="article:author"/>
<meta content="howto" property="article:section">
<meta content="AWS" property="article:tag"/>
<meta content="AWS Lambda" property="article:tag"/>
<meta content="docker" property="article:tag"/>
<meta content="python" property="article:tag"/>
<meta content="https://coleyon.github.io/images/profile.png" property="og:image"/>
<title>wof – AWS Lambda をコンテナイメージでデプロイする</title>
<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-8759671048737588",
      enable_page_level_ads: true
    });
  </script>
<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){
    w[l]=w[l]||[];
    w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MFGZCPR');
</script>
<!-- End Google Tag Manager --></meta></meta></link></head>
<body class="light-theme">
<!-- Google Tag Manager -->
<noscript>
<iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-MFGZCPR" style="display:none;visibility:hidden" width="0"></iframe>
</noscript>
<!-- End Google Tag Manager --> <aside>
<div>
<h1>
<a href="https://coleyon.github.io">wof</a>
</h1>
<p>Techblog</p>
<form action="/search.html" class="navbar-search" role="search">
<input id="tipue_search_input" name="q" placeholder="Search..." type="text"/>
</form>
<nav>
<ul class="list">
<li>
<a href="https://coleyon.github.io/pages/about.html#about" target="_self">
                  About This Site
                </a>
</li>
<li>
<a href="https://coleyon.github.io/pages/policies.html#policies" target="_self">
                  Policies
                </a>
</li>
</ul>
</nav>
<ul class="social">
<li>
<a class="sc-github" href="https://github.com/coleyon/" target="_blank">
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
</aside>
<main>
<nav>
<a href="https://coleyon.github.io">Home</a>
<a href="/archives.html">Archives</a>
<a href="/categories.html">Categories</a>
<a href="/tags.html">Tags</a>
<a href="https://coleyon.github.io/feeds/all.atom.xml">Atom</a>
</nav>
<article class="single">
<header>
<h1 id="aws, lambda, docker">AWS Lambda をコンテナイメージでデプロイする</h1>
<p>
      Posted on 2021-05-29 (土) in <a href="https://coleyon.github.io/category/howto.html">howto</a>
</p>
</header>
<div>
</div>
<div>
<h1>概要</h1>
<p>2020 年の 12 月に、AWS Lambda 関数のデプロイパッケージ形態に、Docker コンテナイメージを選択できるようになりました。
早速試してみたところ使い勝手も良好でしたので記事化してみます。</p>
<ul>
<li>https://dev.classmethod.jp/articles/lambda-support-oci-container-image/</li>
<li>https://dev.classmethod.jp/articles/reinvent2020-svs209/</li>
</ul>
<h1>ダイジェスト</h1>
<ul>
<li>CodeCommit -&gt; CodeBuild -&gt; ECR -&gt; Lambda の流れでデプロイ</li>
<li>Amazon Linux2 ベースの python 3.8 コンテナベース</li>
<li>python 3.8 ベースの ETL スクリプト</li>
<li>パッケージ : cx_Oracle + Pandas + boto3</li>
<li>パスワードなどのシークレットは Secret Manager で管理</li>
</ul>
<h1>何がうれしいの？</h1>
<p>従来は、AWS Lambda のデプロイパッケージサイズの上限は、Zip アーカイブとレイヤ一式の合計サイズの<a href="https://docs.aws.amazon.com/ja_jp/lambda/latest/dg/gettingstarted-limits.html">250MB が上限</a>でしたが、新たにイメージサイズが最大 10GB の Docker コンテナイメージによるデプロイがサポートされるようになったことで、より大きなコードや環境のデプロイが可能になりました。</p>
<p>私は Python で、複数のシステム間の ETL を書く機会が多いのですが、ETL って Storage, RDB, WebAPI などのような複数の技術やデータソースを扱うため、自然と扱うライブラリが増えるんですよね。すると、100 行に満たない実行時間が 10～20 秒ほどのコードでも、ライブラリのサイズつまり AWS Lambda のレイヤーの合計サイズは上限の 250MB を簡単に上回ります。つまり、処理の規模は FaaS 向きなのに、Lambda ではなく AWS Batch や EC2 の利用が視野に入ってしまい、あまりクラウド上で開発するメリットが出しにくい。というジレンマがありました。</p>
<h1>コンテナを書く</h1>
<h1>コンテナイメージを ECR に登録する</h1>
<h1>コンテナイメージを AWS Lambda へデプロイする</h1>
</div>
<div class="tag-cloud">
<p>
<a href="https://coleyon.github.io/tag/aws.html">AWS</a>
<a href="https://coleyon.github.io/tag/aws-lambda.html">AWS Lambda</a>
<a href="https://coleyon.github.io/tag/docker.html">docker</a>
<a href="https://coleyon.github.io/tag/python.html">python</a>
</p>
</div>
<div class="related-posts">
<h4>関連性が高い記事</h4>
<ul class="related-posts">
<li><a href="https://coleyon.github.io/discord, bot, programming.html">Discord の Bot に定時実行をさせてみよう</a></li>
<li><a href="https://coleyon.github.io/google, python, programming.html">GCP で Google Calendar を CalDAV サーバに複製する</a></li>
</ul>
</div>
<script async="" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle ads-responsive" data-ad-client="ca-pub-8759671048737588" data-ad-slot="2472463282"></ins>
<script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'coleyon-dev';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>
<footer>
<p>
  © 2021  - This work is licensed under a <a href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" rel="license" target="_blank">Creative Commons Attribution-ShareAlike</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p><p>
<a href="http://creativecommons.org/licenses/by-sa/4.0/" rel="license" target="_blank">
<img alt="Creative Commons License" height="15" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" style="border-width:0" title="Creative Commons License" width="80"/>
</a>
</p> </footer>
</main>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " wof ",
  "url" : "https://coleyon.github.io",
  "image": "https://coleyon.github.io/images/profile.png",
  "description": "subdescr"
}
</script>
</body>
</html>